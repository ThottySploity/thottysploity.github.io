<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>CVE-2024-53376 CyberPanel Authenticated RCE :: Thotty</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="This article discloses the discovery, exploitation and responsible disclosure of an authenticated command injection zero-day vulnerability in the CyberPanel software solution" />
<meta name="keywords" content="" />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="/posts/cve-2024-53376/" />






  
  
  
  
  
  <link rel="stylesheet" href="/styles.css">







  <link rel="shortcut icon" href="/img/theme-colors/orange.png">
  <link rel="apple-touch-icon" href="/img/theme-colors/orange.png">



<meta name="twitter:card" content="summary" />

  
    <meta name="twitter:site" content="" />
  
    <meta name="twitter:creator" content="Thottysploity" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="CVE-2024-53376 CyberPanel Authenticated RCE">
<meta property="og:description" content="This article discloses the discovery, exploitation and responsible disclosure of an authenticated command injection zero-day vulnerability in the CyberPanel software solution" />
<meta property="og:url" content="/posts/cve-2024-53376/" />
<meta property="og:site_name" content="Thotty" />

  
    <meta property="og:image" content="/img/favicon/orange.png">
  

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">


  <meta property="article:published_time" content="2024-12-18 00:00:00 &#43;0000 UTC" />












</head>
<body class="orange">


<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    ThottySploity
  </div>
</a>

    </div>
    
      <ul class="menu menu--mobile">
  <li class="menu__trigger">Menu&nbsp;â–¾</li>
  <li>
    <ul class="menu__dropdown">
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/writeups">Write-ups</a></li>
        
      
      
    </ul>
  </li>
</ul>

    
    
  </div>
  
    <nav class="navigation-menu">
  <ul class="navigation-menu__inner menu--desktop">
    
      
        
          <li><a href="/about" >About</a></li>
        
      
        
          <li><a href="/writeups" >Write-ups</a></li>
        
      
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="/posts/cve-2024-53376/">CVE-2024-53376 CyberPanel Authenticated RCE</a>
  </h1>
  <div class="post-meta"><time class="post-date">2024-12-18</time><span class="post-author">Thottysploity</span></div>

  
  


  

  <div class="post-content"><div>
        <h1 id="1-introduction"><code>1</code> Introduction<a href="#1-introduction" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>This article shows the research, development, exploitation and responsible disclosure of a zero-day vulnerability in the CyberPanel software solution. CyberPanel is a web hosting control panel for OpenLiteSpeed and LiteSpeed Enterprise. It is alternative to cPanel or Plesk (cyberpanel.net). This vulnerability lives in version prior to 2.3.8 of CyberPanel.</p>
<h1 id="2-terminology"><code>2</code> Terminology<a href="#2-terminology" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>This chapter gives some insight into the terms used throughout this article.</p>
<table>
<thead>
<tr>
<th>Term</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Burpsuite</td>
<td>BurpSuite is a tool used to test and fix security problems in websites. It helps find weaknesses that hackers could exploit.</td>
</tr>
<tr>
<td>Cloud</td>
<td>Cloud is a service that lets you store and access data or run applications over the internet instead of on your computer&rsquo;s hard drive.</td>
</tr>
<tr>
<td>Opensource</td>
<td>Open source is software with code that is made freely available for anyone to use, modify, and share.</td>
</tr>
<tr>
<td>Python</td>
<td>Python is a popular programming language used to write software. It&rsquo;s easy to learn and is used for building websites, analyzing data, automating tasks, and more.</td>
</tr>
<tr>
<td>Server</td>
<td>A server is a powerful computer that stores data or runs services, which can be accessed by other computers over a network.</td>
</tr>
<tr>
<td>Vulnerability</td>
<td>A vulnerability is a weakness or flaw in a system, software, or device that can be exploited by someone.</td>
</tr>
</tbody>
</table>
<h1 id="3-obtaining-the-platform-code"><code>3</code> Obtaining the platform code<a href="#3-obtaining-the-platform-code" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>CyberPanel is an opensource software solution for managing cloud servers, which is hosted on Github. Github is a hosting service for software projects. The github link for CyberPanel is: <a href="https://github.com/usmannasir/cyberpanel">https://github.com/usmannasir/cyberpanel</a>. CyberPanel provides the user with an easy-to-use installer <code>sh &lt;(curl https://cyberpanel.net/install.sh || wget -O - https://cyberpanel.net/install.sh)</code> which also allows to select the version to install.</p>

<img src="/img/installer.png"  alt="CyberPanel Installer"  class="center"  style="border-radius: 8px;"    />


<p>Even when using the installer for version <code>2.3.9</code> we can choose to install another version, like the vulnerable version <code>2.3.7</code>. To execute this installer <code>root</code> user is required to be used, thus CyberPanel also runs as the <code>root</code> user. The machine will restart once, when logging back into the root user the user will be greeted with the following message:</p>

<img src="/img/motd.png"  alt="CyberPanel MoTD"  class="center"  style="border-radius: 8px;"    />


<p>I had to hide the <code>Log in</code> as this exposes my public IP :)</p>
<p>Once we now go to <code>localhost:8090</code> we see the following:</p>

<img src="/img/cyberpanel_login.png"  alt="CyberPanel Login page"  class="center"  style="border-radius: 8px;"    />


<p>The admin password is funky, so I change it to something that can be easily remembered using the following command <code>adminPass Welkom01</code></p>

<img src="/img/admin_pass.png"  alt="CyberPanel Admin password"  class="center"  style="border-radius: 8px;"    />


<p>Now we can log into our CyberPanel instance using the credentials <code>admin:Welkom01</code>. We can check the current version that is running by selecting <code>Version management</code> and looking at the <code>Current version</code> and <code>Build</code></p>

<img src="/img/current_version.png"  alt="CyberPanel Version 2.3.7"  class="center"  style="border-radius: 8px;"    />


<p>Here we can see that we&rsquo;re running on version <code>2.3.7</code>.</p>
<h1 id="4-identifying-vulnerabilities"><code>4</code> Identifying vulnerabilities<a href="#4-identifying-vulnerabilities" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>Since we know that the CyberPanel is written using the Python language, which can be seen from the file extensions that are used within the files.

<img src="/img/python_files.png"  alt="CyberPanel Python"  class="center"  style="border-radius: 8px;"    />

</p>
<p>Knowing that it is Python, I started hunting for any way that CyberPanel executes code on the underlying operating system. This is a way that Remote Code Execution can be achieved. A way to do this is to open a random file and searching for any indication of functions that can execute code:</p>

<img src="/img/executioner_found.png"  alt="CyberPanel Executioner"  class="center"  style="border-radius: 8px;"    />


<p>Here we can see that <code>execPath</code> is being parsed to the function <code>ProcessUtilities.executioner</code>, without making an assumption lets take a look at this <code>executioner</code>.</p>

<img src="/img/executioner.png"  alt="CyberPanel Executioner"  class="center"  style="border-radius: 8px;"    />


<p>The <code>executioner</code> function checks the current logged-in user using the <code>getpass.getuser()</code> function. Remember that it was required to run as root? Yeah.. <em>spoiler alert</em> it runs everything as root.</p>
<p>Since we know this we need to look at the <code>ProcessUtilities.normalExecutioner</code> function:</p>

<img src="/img/normal_executioner.png"  alt="CyberPanel Normal Executioner"  class="center"  style="border-radius: 8px;"    />


<p>Funnily enough, if we were running as a different user that is not <code>None</code> and not <code>root</code> CyberPanel would still try and run it using <code>sudo</code> permissions! Regardless, it runs as root already :)</p>
<p>CyberPanel uses the following functions that can all execute code on the underlying operating system:</p>
<ul>
<li>ProcessUtilities.executioner</li>
<li>ProcessUtilities.normalExecutioner</li>
<li>ProcessUtilities.sendCommand</li>
<li>ProcessUtilities.outputExecutioner</li>
<li>ProcessUtilities.customPoen</li>
<li>ProcessUtilities.BuildCommand</li>
<li>ProcessUtilities.popenExecutioner</li>
</ul>
<p>Why would you need 7 different functions that can all execute code?? I probably missed some too!</p>
<p>Time to actually hunt vulnerable functions.</p>

<img src="/img/files.png"  alt="CyberPanel Python files"  class="center"  style="border-radius: 8px;"    />


<p>CyberPanel contains <code>807</code> Python files, ain&rsquo;t no way looking through each and every one looking for a specific function.. that would take ages!</p>
<p>Luckily we can use <code>grep</code> to look quickly for us, for example with the command <code>grep -rni &quot;ProcessUtilities.popenExecutioner&quot;</code> (Normally you would go through all the functions, for this writeup the vulnerable function uses the popenExecutioner which is why I demo it here).</p>

<img src="/img/instances_found.png"  alt="CyberPanel Executioner instances"  class="center"  style="border-radius: 8px;"    />


<p>After reading, theorizing and trying functions I found an interesting candidate within the <code>websiteFunctions\website.py</code> file. The function <code>submitWebsiteCreation</code> used user controlled variables that were directly parsed to the exectioner without firstly being sanitized or checked.</p>

<img src="/img/submitWebsiteCreation.png"  alt="submitWebsiteCreation variables"  class="center"  style="border-radius: 8px;"    />


<p>The <code>submitWebsiteCreation</code> function uses the following user defined variables:</p>
<ul>
<li>domain</li>
<li>adminEmail</li>
<li>phpSelection</li>
<li>packageName</li>
<li>websiteOwner</li>
</ul>
<p>Now not every variable is ideal for injection, the reasoning for this are <code>validators</code>. Validators is the worst nightmare for a hacker as this checks if the input given by a user is actually valid.</p>
<p>The <code>domain</code> variable has a validator.</p>

<img src="/img/validator_domain.png"  alt="Domain validator"  class="center"  style="border-radius: 8px;"    />


<p>The <code>adminEmail</code> variable also has a validator.</p>

<img src="/img/validator_email.png"  alt="Email validator"  class="center"  style="border-radius: 8px;"    />


<p>The <code>phpSelection</code> variable however does not have a validator, added bonus is that it gets parsed directly to the executor:</p>

<img src="/img/directly_parsed.png"  alt="Non PhpSelection validator"  class="center"  style="border-radius: 8px;"    />


<p>Now we know we have a possible executor we need to actually prove that it is vulnerable.</p>
<h1 id="5-proof-of-concept"><code>5</code> Proof-of-Concept<a href="#5-proof-of-concept" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>It is possible to make a Python exploit script to test the vulnerability, however a quicker way (that also shows a lot more) is BurpSuite. BurpSuite allows us to see what is normally hidden from view, thus also improving the time required to write an exploit script.</p>

<img src="/img/burpsuite_login.png"  alt="BurpSuite Login to CyberPanel"  class="center"  style="border-radius: 8px;"    />


<p>We see a couple of interesting things, namely that the login is being made using a <code>POST</code> request to the <code>/verifyLogin</code> endpoint. It also encodes the login credentials using JSON as shown below.</p>



  <div class="collapsable-code">
    <input id="1" type="checkbox"  />
    <label for="1">
      <span class="collapsable-code__language">json</span>
      
      <span class="collapsable-code__toggle" data-label-expand="Show" data-label-collapse="Hide"></span>
    </label>
    <pre class="language-json" ><code>
   {
     &#34;username&#34;:&#34;admin&#34;,
     &#34;password&#34;:&#34;Welkom01&#34;,
     &#34;languageSelection&#34;:&#34;english&#34;
   }
</code></pre>
  </div>


<p>Furthermore CyberPanel uses a <code>csrftoken</code> embedded in the Cookie, aswell as a <code>X-Csrftoken</code> in the header. Once we forward the requests within BurpSuite we can see we&rsquo;ve now obtained a <code>sessionid</code> which indicates that we&rsquo;re authenticated with our CyberPanel instance.</p>

<img src="/img/session_id.png"  alt="CyberPanel Session"  class="center"  style="border-radius: 8px;"    />


<p>We can now move to the vulnerable page that calls our vulnerable function. This can be found under the <code>Websites</code> tab and <code>Create Website</code></p>

<img src="/img/calling_vuln.png"  alt="CyberPanel Create Website"  class="center"  style="border-radius: 8px;"    />


<p>Intercepting this request using BurpSuite we get to see the following:</p>

<img src="/img/vulnerable_function.png"  alt="CyberPanel Create Website Code"  class="center"  style="border-radius: 8px;"    />


<p>We know the vulnerability lies within the <code>phpSelection</code> variable, so lets see what happends when we send our exploit by adding <code>'; touch /tmp/PoC; #</code> to the end of <code>phpSelection</code>.</p>

<img src="/img/error.png"  alt="Exploit Attempt Error"  class="center"  style="border-radius: 8px;"    />


<p>We see that our exploit attempt is stopped, because it filters characters like <code>$ &amp; ( ) [ ] { } ; :</code>. Lets see how the function that is responsible for this actually works. We can find this function by using <code>grep -rni &quot;Data supplied is not accepted&quot;</code>:</p>

<img src="/img/secMiddleWare.png"  alt="Exploit Attempt Error"  class="center"  style="border-radius: 8px;"    />


<p>We can see that the file <code>CyberCP\secMiddleWare.py</code> is responsible for stopping our exploit attempt, lets see if we can bypass this filter.</p>

<img src="/img/SecMiddleWareInner.png"  alt="Filter"  class="center"  style="border-radius: 8px;"    />


<p>The filter looks to be filtering every character that is used for Command Injection. There is one HUGE mistake tho.. and that is the assumption that only <code>POST</code> can be used to submit data. <code>OPTIONS</code> can do exactly the same.. So changing the method from <code>POST</code> to <code>OPTIONS</code> we get the following result:</p>

<img src="/img/success.png"  alt="Filter"  class="center"  style="border-radius: 8px;"    />


<p>When looking at <code>/tmp/</code> location using <code>ls -la</code> we see the following:</p>

<img src="/img/file_made.png"  alt="Filter"  class="center"  style="border-radius: 8px;"    />


<p>The owner of the file is <code>root</code> which proves that the command is being executed as the root user. We can further prove this by issuing a <code>whoami</code> and <code>id</code> and outputting it to this file. Instead of <code>PHP 8.0'; touch /tmp/PoC; #</code> we use <code>PHP 8.0'; whoami &gt; /tmp/PoC &amp;&amp; id &gt;&gt; /tmp/PoC; #</code></p>

<img src="/img/root_whoami.png"  alt="Whoami"  class="center"  style="border-radius: 8px;"    />


<p>To do the exploit, we need the <code>csrftoken</code> and <code>sessionid</code>. The <code>csrftoken</code> is the same as the <code>X-Csrftoken</code>.</p>

<img src="/img/authenticating.png"  alt="Whoami"  class="center"  style="border-radius: 8px;"    />


<p>Lastly we need the headers and payload to actually exploit the vulnerability:</p>

<img src="/img/exploit_headers.png"  alt="Whoami"  class="center"  style="border-radius: 8px;"    />


<p>The full PoC code is available on: <a href="https://github.com/ThottySploity/CVE-2024-53376">https://github.com/ThottySploity/CVE-2024-53376</a></p>
<h1 id="6-mitigation"><code>6</code> Mitigation<a href="#6-mitigation" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>To mitigate this vulnerability, the core problem needs to be handles which is the only sanitization of <code>POST</code> requests. Ideally any method is sanitized.</p>
<h1 id="7-responsible-disclosure"><code>7</code> Responsible Disclosure<a href="#7-responsible-disclosure" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<ul>
<li>30.10.2024 - Identified vulnerability</li>
<li>31.10.2024 - Contacted Usman Nasir, owner of CyberPanel</li>
<li>02.11.2024 - Usman fixed the issue and published a fix</li>
<li>03.11.2024 - Requested CVE-ID from MITRE</li>
<li>23.11.2024 - MITRE reserved CVE-ID 2024-53376</li>
<li>15.12.2024 - CVE-2024-53376 published to the public</li>
</ul>
<h1 id="8-references"><code>8</code> References<a href="#8-references" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<ul>
<li><a href="https://cyberpanel.net/">https://cyberpanel.net/</a></li>
</ul>

      </div></div>

  
    
<div class="pagination">
    <div class="pagination__title">
        <span class="pagination__title-h">Read other posts</span>
        <hr />
    </div>
    <div class="pagination__buttons">
        
        
        <span class="button next">
            <a href="/posts/cve-2024-53375/">
                <span class="button__text">CVE-2024-53375 TP-Link Archer router series Authenticated RCE</span>
                <span class="button__icon">â†’</span>
            </a>
        </span>
        
    </div>
</div>

  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>Â© 2024 Powered by <a href="https://gohugo.io">Hugo</a></span>
    
      <span>:: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank">Theme</a> made by <a href="https://github.com/panr" target="_blank">panr</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





  
</div>

</body>
</html>
