<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>How a threat actor moves laterally through a network :: Thotty</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="This article delves into the techniques utilized by threat actors while navigating a company&#39;s network laterally. Its objective is to assist network administrators in comprehending the risks tied to lateral movement, unraveling the process, and outlining preventive measures." />
<meta name="keywords" content="" />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="/posts/lateralmovement/" />






  
  
  
  
  
  <link rel="stylesheet" href="/styles.css">







  <link rel="shortcut icon" href="/img/theme-colors/orange.png">
  <link rel="apple-touch-icon" href="/img/theme-colors/orange.png">



<meta name="twitter:card" content="summary" />

  
    <meta name="twitter:site" content="" />
  
    <meta name="twitter:creator" content="Thottysploity" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="How a threat actor moves laterally through a network">
<meta property="og:description" content="This article delves into the techniques utilized by threat actors while navigating a company&#39;s network laterally. Its objective is to assist network administrators in comprehending the risks tied to lateral movement, unraveling the process, and outlining preventive measures." />
<meta property="og:url" content="/posts/lateralmovement/" />
<meta property="og:site_name" content="Thotty" />

  
    <meta property="og:image" content="/img/favicon/orange.png">
  

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">


  <meta property="article:published_time" content="2023-11-24 00:00:00 &#43;0000 UTC" />












</head>
<body class="orange">


<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    ThottySploity
  </div>
</a>

    </div>
    
      <ul class="menu menu--mobile">
  <li class="menu__trigger">Menu&nbsp;▾</li>
  <li>
    <ul class="menu__dropdown">
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/writeups">Write-ups</a></li>
        
      
      
    </ul>
  </li>
</ul>

    
    
  </div>
  
    <nav class="navigation-menu">
  <ul class="navigation-menu__inner menu--desktop">
    
      
        
          <li><a href="/about" >About</a></li>
        
      
        
          <li><a href="/writeups" >Write-ups</a></li>
        
      
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="/posts/lateralmovement/">How a threat actor moves laterally through a network</a>
  </h1>
  <div class="post-meta"><time class="post-date">2023-11-24</time><span class="post-author">Thottysploity</span></div>

  
  


  

  <div class="post-content"><div>
        <h1 id="1-what-is-lateral-movement"><code>1</code> What is Lateral Movement?<a href="#1-what-is-lateral-movement" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>Lateral movement refers to the actions and techniques employed by threat actors to advance further within a network. Another term that is used for this is pivoting, however there is a difference between lateral movment and pivoting where the key difference lies in the approach. Lateral movement refers to moving across different Active Directory (AD) users while pivoting referes to moving from one system to another. I have found that lateral movement and pivoting are used rather interchangably.</p>
<h1 id="2-how-is-lateral-movement-performed"><code>2</code> How is Lateral Movement performed<a href="#2-how-is-lateral-movement-performed" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>This chapter will explain how lateral movement is performed</p>
<h1 id="21-domain-admin-vs-local-admin"><code>2.1</code> Domain Admin vs Local Admin<a href="#21-domain-admin-vs-local-admin" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>When a threat actor gets access to a server or workstation they have a defined goal in mind, getting Domain Admin. Why is the goal to get Domain Admin level access you may ask? well that is a simple answer; the Domain Admin has full control of the whole domain. When an attacker gets access to Domain Admin they can perform any command on any server that they want.</p>
<p>There are a couple differences between Local Admins and Domain Admins. The image below shows the differences.</p>

<img src="/img/domainvslocal.png"  alt="Domain Admin vs Local Admin"  class="center"  style="border-radius: 8px;"    />


<p>So, where a Local Admin is restricted to just one machine a Domain Admin is not restricted to the same issue. This account can access any server in a domain from a workstation to a domain controller and everything in between.</p>
<h1 id="22-recon-recon-and-more-recon"><code>2.2</code> Recon, Recon and more Recon.<a href="#22-recon-recon-and-more-recon" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>When threat actors drop into an environment they want to know what kind of environment it is. They want to map the network; who are the users in the network, what shares are available, what are the domain controllers (ip address, name, and how many), what servers and workstations are in the network and whom are the domain admins.</p>
<p>Threat actors can use custom tools and open-source tools to do recon in a network however Windows itself delivers tools that can also give information about a network. When a threat actor uses these tools we call this living-off-the-land, they utilize tools that are already present on the system which makes them harder to detect.</p>
<p>A tool that is very useful for reconnaissance is Bloodhound. Bloodhound is a tool that can identify user permissions, sessions, attack paths and hidden relations inside of Domain. Want to know the best thing about it? everything can be collected with having just domain user permissions. The image below is an overview of Bloodhound that collected information about a Domain.</p>

<img src="/img/Bloodhound.jpg"  alt="Bloodhound"  class="center"  style="border-radius: 8px;"    />


<p>The attack path I have highlighted in red is the attack path I am going to demonstrate. We start all the way on the left at <code>1</code> and will move laterally through the network all the way to <code>2.1</code>.</p>
<p>To make this attack path more insightful I have drawn the image below:</p>

<img src="/img/attackpath.png"  alt="Attack Path to take"  class="center"  style="border-radius: 8px;"    />


<p>We will start at the user: <code>NoPriv</code> that runs on the workstation which is just a normal user account, this user account cannot execute commands on the server. On this workstation also runs an account named <code>WorkStationAdmin</code> which does have permissions to execute commands on the server. However this account is not a Domain Admin account for this we will have to get access to the <code>DcUser</code> account, luckily for us his session is running on this server.</p>
<p>So our attack chain looks as follows:</p>

<img src="/img/attackchain.png"  alt="Attack chain"  class="center"  style="border-radius: 8px;"    />


<p>Note: We don&rsquo;t need to escalate to local admin on the server, as <code>WorkStationAdmin</code> is already a local admin.</p>
<h1 id="22-now-in-practice"><code>2.2</code> Now in practice<a href="#22-now-in-practice" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>I will start from a user level account, escalate my privileges and follow the same attack scheme as shown within Bloodhound. I am using my own tooling to achieve this goal however I will mention alternatives to my tooling.</p>
<h1 id="221-privilege-escalation"><code>2.2.1</code> Privilege Escalation<a href="#221-privilege-escalation" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>As we&rsquo;re running as a user level account we first must escalate these permissions. The reasoning for this is because user accounts can&rsquo;t really do anything. To escalate our permissions I will be using the CMSTPLUA COM User Account Control (UAC)-bypass.</p>
<p>As you can see in the image below I am a normal user with no privileges at all and I don&rsquo;t have permissions to execute any commands on the server.</p>

<img src="/img/noprivuser.png"  alt="No privilege user"  class="center"  style="border-radius: 8px;"    />


<h1 id="3-how-can-lateral-movement-be-prevented"><code>3</code> How can Lateral Movement be prevented?<a href="#3-how-can-lateral-movement-be-prevented" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<h1 id="4-conclusion"><code>4</code> Conclusion<a href="#4-conclusion" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>t</p>
<h1 id="references">References<a href="#references" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<ul>
<li><a href="https://www.crowdstrike.com/cybersecurity-101/lateral-movement/">https://www.crowdstrike.com/cybersecurity-101/lateral-movement/</a></li>
<li><a href="https://www.reddit.com/r/CompTIA/comments/p223eb/is_there_a_technical_difference_between_pivot_and/?rdt=50866">https://www.reddit.com/r/CompTIA/comments/p223eb/is_there_a_technical_difference_between_pivot_and/?rdt=50866</a></li>
<li><a href="https://blog.netwrix.com/2022/12/09/bloodhound-active-directory/">https://blog.netwrix.com/2022/12/09/bloodhound-active-directory/</a></li>
</ul>

      </div></div>

  
    
<div class="pagination">
    <div class="pagination__title">
        <span class="pagination__title-h">Read other posts</span>
        <hr />
    </div>
    <div class="pagination__buttons">
        
        
        <span class="button next">
            <a href="/posts/echohno/">
                <span class="button__text">Outsmarting Antivirus [Echo AC Edition]</span>
                <span class="button__icon">→</span>
            </a>
        </span>
        
    </div>
</div>

  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2024 Powered by <a href="https://gohugo.io">Hugo</a></span>
    
      <span>:: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank">Theme</a> made by <a href="https://github.com/panr" target="_blank">panr</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





  
</div>

</body>
</html>
